<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="order_form.css">
    <title>Order Management Premium</title>
</head>
<body>

<div class="container">
    <div class="toolbar">
        <div> <b>ใบเสร็จรับ-ส่งสินค้า / ใบเสร็จรับเงิน</b></div>
        <div class="btn-group">
            <button onclick="window.location.href='history_view.html';">OK</button>
        </div>
    </div>

    <div class="form-grid">
        <div class="left-col">
            <div class="form-group">
                <label>No:</label>
                <input type="text" value="ORD-001">
            </div>
            <div class="form-group">
                <label>วันที่:</label>
                <input type="date">
            </div>
            <div class="form-group">
                <label>การชำระเงิน:</label>
                <select>
                    <option>ชำระต้นทาง</option>
                    <option>ชำระปลายทาง</option>
                </select>
            </div>
        </div>
        <div class="right-col">
            <div class="form-group">
                <label>คนส่ง:</label>
                <input type="text" placeholder="ชื่อผู้ส่ง">
            </div>
            <div class="form-group">
                <label>คนรับ:</label>
                <input type="text" placeholder="ชื่อผู้รับ">
            </div>
        </div>
    </div>

    <div class="table-section">
        <div class="table-header">
            <span style="font-size: 1.4em; font-weight: bold; color: var(--main-dark);">รายละเอียด</span>
            <button class="btn-add" onclick="addRow()">+ เพิ่มรายการ</button>
        </div>
        <table id="orderTable">
            <thead>
                <tr>
                    <th width="10%">จำนวน</th>
                    <th width="12%">หน่วย</th>
                    <th width="38%">รายการ</th>
                    <th width="15%">ราคา/หน่วย</th>
                    <th width="15%">รวม</th>
                    <th width="10%">ลบ</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr>
                    <td><input type="number" class="qty" oninput="calculateRow(this)" value="1"></td>
                    <td><input type="text" placeholder="หน่วย"></td>
                    <td><input type="text" placeholder="ระบุรายการสินค้า"></td>
                    <td><input type="number" class="price" oninput="calculateRow(this)" value="0"></td>
                    <td class="total-row" style="text-align: right; font-weight: bold; color: var(--main-dark);">0.00</td>
                    <td style="text-align:center;"><button class="btn-del" onclick="deleteRow(this)">×</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="summary">
        <span class="total-label">รวมทั้งหมด:</span>
        <span id="grandTotal">0.00</span>
    </div>
</div>

<script>
    function addRow() {
        const tableBody = document.getElementById("tableBody");
        const newRow = tableBody.insertRow();
        newRow.innerHTML = `
            <td><input type="number" class="qty" oninput="calculateRow(this)" value="1"></td>
            <td><input type="text" placeholder="หน่วย"></td>
            <td><input type="text" placeholder="ระบุรายการสินค้า"></td>
            <td><input type="number" class="price" oninput="calculateRow(this)" value="0"></td>
            <td class="total-row" style="text-align: right; font-weight: bold; color: var(--main-dark);">0.00</td>
            <td style="text-align:center;"><button class="btn-del" onclick="deleteRow(this)">×</button></td>
        `;
    }

    function deleteRow(btn) {
        const row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
        calculateGrandTotal();
    }

    function calculateRow(input) {
        const row = input.parentNode.parentNode;
        const qty = parseFloat(row.querySelector('.qty').value) || 0;
        const price = parseFloat(row.querySelector('.price').value) || 0;
        const total = qty * price;
        
        row.querySelector('.total-row').innerText = total.toLocaleString(undefined, {
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2
        });
        
        calculateGrandTotal();
    }

    function calculateGrandTotal() {
        let sum = 0;
        const allTotalCells = document.querySelectorAll('.total-row');
        allTotalCells.forEach(cell => {
            const val = parseFloat(cell.innerText.replace(/,/g, '')) || 0;
            sum += val;
        });
        document.getElementById('grandTotal').innerText = sum.toLocaleString(undefined, {
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2
        });
    }
</script>

</body>
</html>